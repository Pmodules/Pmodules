#!/bin/bash

declare prefix='/opt/psi'
declare distfiles='/afs/psi.ch/software/Pmodules/distfiles'

print_usage() {
	echo "${0##*/} [OPTS]" 1>&2
	exit 1
}

while (( $# > 0 )); do
	case $1 in
	--prefix=* )
		prefix=${1#*=}
		;;
	--distfiles=* )
		distfile=${1#*=}
		;;
	--help | -h | -\? )
		print_usage
		exit 1
		;;
	-* )
		echo "$1: invalid option." 1>&2
		exit 1
		;;
	* )
		echo "$1: invalid argument." 1>&2
		exit 1
		;;
	esac
	shift
done

echo "PMODULES_ROOT=$prefix"
echo "PMODULES_DISTFILESDIR=$distfiles"

sed_cmd="s:@PMODULES_ROOT@:${prefix}:g;"
sed_cmd+="s:@PMODULES_DISTFILESDIR@:${distfiles}:g;"

sed "${sed_cmd}" "config/environment.bash.in" > "config/environment.bash"

